{% extends "base.html" %}
{% block title %}cmdb{% endblock %}
{% block css %}
<link rel="stylesheet" href="/static/layui/css/layui.css" type="text/css" />
<link rel="stylesheet" href="/static/js/layer/skin/default/layer.css" type="text/css" />
<link rel="stylesheet" href="/static/css/app.v2.css" type="text/css" />
<link rel="stylesheet" href="/static/js/calendar/bootstrap_calendar.css" type="text/css" cache="false" />
<link rel="stylesheet" href="/static/js/datatables/datatables.css" type="text/css" cache="false">
<link rel="stylesheet" href="/static/css/font.css" type="text/css" cache="false" />
{% endblock %}
{% block menusection %}
<section class="w-f scrollable">
            <div class="slim-scroll" data-height="auto" data-disable-fade-out="true" data-distance="0" data-size="5px" data-color="#333333"> <!-- nav -->
              <nav class="nav-primary hidden-xs">
                <ul class="nav">
                  <li> <a href="/"> <i class="fa fa-dashboard icon"> <b class="bg-danger"></b> </i> <span>资产概览</span> </a> </li>
                  <li class="active"> <a href="#layout" class="active"> <i class="fa fa-columns icon"> <b class="bg-warning"></b> </i> <span class="pull-right"> <i class="fa fa-angle-down text"></i> <i class="fa fa-angle-up text-active"></i> </span> <span>salt管理</span> </a>
                    <ul class="nav lt">
                      <li class="active"> <a href="/saltadmin/" class="active"> <i class="fa fa-angle-right"></i> <span>salt远程管理</span> </a> </li>
                      <li > <a href="/salthistory/" > <i class="fa fa-angle-right"></i> <span>salt命令历史</span> </a> </li>
                      <li > <a href="/saltconfigview/" > <i class="fa fa-angle-right"></i> <span>salt配置概览</span> </a> </li>
                    </ul>
                  </li>
                  <li > <a href="#codepublish" > <i class="fa fa-flask icon"> <b class="bg-success"></b> </i> <span class="pull-right"> <i class="fa fa-angle-down text"></i> <i class="fa fa-angle-up text-active"></i> </span> <span>代码发布</span> </a>
                    <ul class="nav lt">
                      <li > <a href="buttons.html" > <i class="fa fa-angle-right"></i> <span>提交更新</span> </a> </li>
                      <li > <a href="icons.html" > <b class="badge bg-info pull-right">369</b> <i class="fa fa-angle-right"></i> <span>所有更新</span> </a> </li>
                      <li > <a href="widgets.html" > <b class="badge pull-right">8</b> <i class="fa fa-angle-right"></i> <span>版本列表</span> </a> </li>
                      <li > <a href="components.html" > <i class="fa fa-angle-right"></i> <span>回滚记录</span> </a> </li>
                      <li > <a href="list.html" > <i class="fa fa-angle-right"></i> <span>审核发布</span> </a> </li>
                    </ul>
                  </li>
                  <li > <a href="mail.html" > <b class="badge bg-danger pull-right">3</b> <i class="fa fa-envelope-o icon"> <b class="bg-primary dker"></b> </i> <span>Message</span> </a> </li>
                  <li > <a href="notebook.html" > <i class="fa fa-pencil icon"> <b class="bg-info"></b> </i> <span>Notes</span> </a> </li>
                </ul>
              </nav>
              <!-- / nav --> </div>
          </section>
{% endblock %}
{% block content %}
        <section class="vbox">
          <section class="scrollable padder">
            <ul class="breadcrumb no-border no-radius b-b b-light pull-in">
              <li><a href="/"><i class="fa fa-home"></i> Home</a></li>
              <li class="active">salt 远程管理</li>
            </ul>
            <section class="panel panel-default">
              <header class="panel-heading">Minion Configure<i class="fa fa-info-sign text-muted" data-toggle="tooltip" data-placement="bottom" ></i> </header>
              <div class="table-responsive">
                <table class="table table-striped m-b-none">
                  <thead>
                  <th><label for="minion">请输入minions：</label></th>
                  <th><label for="miniontype">请选择minions的类型:</label></th>
                  <th><label for="minion">请输入要执行的module：</label></th>
                  <th><label for="minion">请输入要执行的module的参数：</label></th>
                  <th>Submit</th>
                  </thead>
                  <tbody>
                    <tr>
                    <td><input id='minion' style='width:102px' type="text" name="minion"/></td>
                    <td>
                                <select name="miniontype" id='miniontype'>
                                    <option value="glob">glob</option>
                                    <option value="nodegroup">nodegroup</option>
                                    <option value="pcre">pcre</option>
                                    <option value="list">list</option>
                                    <option value="grain">grain</option>
                                    <option value="grain_pcre">grain_pcre</option>
                                    <option value="range">range</option>
                                    <option value="compound">compound</option>
                                </select>
                    </td>
                    <td><input type="text" id='module' name="module"/></td>
                    <td><input  id='arg' type="text" name="arg"/></td>
                    <td><button type="button" class="layui-btn layui-btn-mini" value="Submit" id="minionsubmit">Submit</button></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </section>
            <section class="panel panel-default">
              <header class="panel-heading">Result<i class="fa fa-info-sign text-muted" data-toggle="tooltip" data-placement="bottom" ></i> </header>
              <div class="table-responsive">
                <table class="table table-striped m-b-none" id="resultdatatables">
                  <thead>
                  <th>minionid</th>
                  <th>result</th>
                  </thead>
                  <tbody>
                  </tbody>
                </table>
              </div>
            </section>
              </section>
              <a href="#" class="btn btn-default btn-sm m-b"><i class="fa fa-plus icon-muted"></i> more</a> </div>
          </section>
        </section>
{% endblock %}
{% block scripts %}
<script src="/static/js/app.v2.js"></script> 
<script src="/static/layui/layui.js"></script> 
<script src="/static/js/layer/layer.js"></script> 
<script src="/static/js/datatables/jquery.dataTables.min.js" cache="false"></script>
<script src="/static/js/charts/easypiechart/jquery.easy-pie-chart.js" cache="false"></script> 
<script src="/static/js/charts/sparkline/jquery.sparkline.min.js" cache="false"></script>
<script src="/static/js/charts/flot/jquery.flot.min.js" cache="false"></script> 
<script src="/static/js/charts/flot/jquery.flot.tooltip.min.js" cache="false"></script>
<script src="/static/js/charts/flot/jquery.flot.resize.js" cache="false"></script> 
<script src="/static/js/charts/flot/jquery.flot.grow.js" cache="false"></script> 
<script src="/static/js/charts/flot/demo.js" cache="false"></script>
<script src="/static/js/calendar/bootstrap_calendar.js" cache="false"></script> 
<script src="/static/js/calendar/demo.js" cache="false"></script> 
<script src="/static/js/sortable/jquery.sortable.js" cache="false"></script>
<script>
$(document).ready(function () {
            $('#minionsubmit').on('click', function(){
                console.log('yes')
                var minion=$('#minion').val();
                var miniontype=$('#miniontype').val();
                var module=$('#module').val();
                var arg=$('#arg').val();
                var index = layer.load();
                 $.ajax({
                  url:'/saltcmdrun/',
                  data:{'minion':minion,'miniontype':miniontype,'module':module,'arg':arg},
                  type:'POST',
                  success:function(callback){
                  layer.close(index); 
                  obj=jQuery.parseJSON(callback);
                  $("#resultdatatables tbody").html("");
                  $.each(obj, function (k, v) {
                      resultdata='<tr> <td >'+k+'</td>'+'<td>'+v+'</td>'+'</tr>'
                    $("#resultdatatables tbody").append(resultdata);
                    });
                   $('#resultdatatables').dataTable({"sPaginationType": "full_numbers","sDom": "<'row'<'col-sm-6'l><'col-sm-6'f>r>t<'row'<'col-sm-6'i><'col-sm-6'p>>"});
                   }
                   });
             });
})
</script>
{% endblock %}
